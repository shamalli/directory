var SABAI=SABAI||{};!function(e){if(SABAI.console=window.console||{log:function(e){alert(e)}},SABAI.isRTL=!1,SABAI.init=function(){var a=function(a){SABAI.fadeout(e(".sabai-fadeout",a))},t=function(a){e("input.sabai-form-check-trigger",a).show().click(function(){var a=e(this);a.closest("table").find("input.sabai-form-check-target, input.sabai-form-check-trigger").not(":disabled").prop("checked",a.prop("checked"))})},i=function(a){e("fieldset.sabai-form-collapsible",a).not(".sabai-form-collapsible-processed").each(function(){var a=e(this);a.find("> legend span:first").prepend('<i class="fa fa-caret-down"></i> ').wrap('<a class="sabai-form-collapsible" href="#"></a>').end().find("a.sabai-form-collapsible:first").click(function(){return e(this).toggleClass("sabai-form-collapsed").find("i").toggleClass("fa-caret-down").toggleClass(SABAI.isRTL?"fa-caret-left":"fa-caret-right").end().closest(".sabai-form-collapsible-processed").toggleClass("sabai-form-collapsed").find(".sabai-form-fields:first").slideToggle("fast",function(){e(this).find("textarea:visible").autosize()}),!1}).end().addClass("sabai-form-collapsible-processed"),a.hasClass("sabai-form-collapsed")&&(a.hasClass("sabai-form-field-error")?a.removeClass("sabai-form-collapsed"):a.find(".sabai-form-fields:first").css({display:"none"}).end().find("a.sabai-form-collapsible:first").addClass("sabai-form-collapsed").find("i").removeClass("fa-caret-down").addClass(SABAI.isRTL?"fa-caret-left":"fa-caret-right"))})},n=function(a){e("textarea:visible",a).autosize()},o=function(a){var t="ontouchstart"in document.documentElement;t||e('[rel="sabaitooltip"]',a).each(function(){var t=e(this),i="sabai-content"===a.attr("id")&&t.closest("#sabai-inline-content").length?t.closest("#sabai-inline-content"):t.data("container")||a;t.sabaitooltip({container:i})}),e("a[data-popover-url]",a).bind("click",function(t){var i=e(this).unbind("hover"),n={html:!0,container:"sabai-content"===a.attr("id")&&i.closest("#sabai-inline-content").length?i.closest("#sabai-inline-content"):i.data("container")||a,url:i.data("popover-url")};SABAI.isRTL?n.placement=function(a,t){return e(t).offset().left>300?"left":"right"}:n.placement=function(a,t){return window.innerWidth-e(t).offset().left>300?"right":"left"},SABAI.popover(i,n),t.preventDefault()})},s=function(a){e("a.sabai-toggle",a).not(".sabai-toggle-processed").unbind("click").click(function(a){var t=e(this).addClass("sabai-toggle-processed"),i=e(t.data("toggle-target"));if(e.trim(i.html())){e(SABAI).trigger("toggle.sabai",{trigger:t,target:i});var n=t.data("toggle-cookie"),o=t.hasClass("sabai-toggle-slide")?"slideToggle":"toggle";i[o]("fast",function(){var a=i.is(":visible");t.toggleClass("sabai-active",a),n&&e.cookie(n,a?1:0,{path:SABAI.path,domain:SABAI.domain}),e(SABAI).trigger("toggled.sabai",{trigger:t,target:i})}),a.preventDefault()}})},r=function(a){e(".sabai-carousel",a).each(function(){var a=e(this);a.data("carousel",a.bxSlider(a.data("carousel-options")||{})),e(SABAI).bind("entity_filter_form_toggled.sabai",function(e,t){a.parents(t.container).length&&a.data("carousel").redrawSlider()})})},l=function(a){e("a.sabai-form-field-add",a).each(function(){var a=e(this),t=a.closest(".sabai-form-fields"),i=parseInt(a.data("field-max-num"));a.click(function(e){var n=a.data("field-next-index");SABAI.cloneField(t,a.data("field-name"),i,n,a),n&&a.data("field-next-index",++n),e.preventDefault()}),t.find("> .sabai-form-field:not(.sabai-form-field-add)").each(function(n){0!==n&&e(this).append('<a class="sabai-btn sabai-btn-danger sabai-btn-xs sabai-form-field-remove" href="#"><i class="fa fa-times" title="Remove this field"></i></a>').find("a.sabai-form-field-remove").click(function(n){e(this).closest(".sabai-form-field").fadeTo("fast",0,function(){e(this).slideUp("fast",function(){e(this).remove(),i&&t.find("> .sabai-form-field:not(.sabai-form-field-add)").length<i&&a.show()})}),n.preventDefault()}).parent().css("position","relative")}),i&&t.find("> .sabai-form-field:not(.sabai-form-field-add)").length>=i&&a.hide()})};return function(c,d){a(c),t(c),i(c),n(c),o(c),s(c),r(c),l(c),"function"==typeof prettyPrint&&prettyPrint(),"function"==typeof e.fn.prettyPhoto&&e('a[rel^="prettyPhoto"]',c).prettyPhoto(),e(".sabai-dropdown-toggle",c).sabaidropdown(),e(".sabai-click",c).click(),d&&d.call(null,c),e(SABAI).trigger("sabai_init.sabai",{context:c})}}(),SABAI.fadeout=function(a,t){t=t||6e3,e(a).animate({opacity:"+=0"},t,function(){e(this).fadeOut("fast",function(){e(this).remove()})})},SABAI.cache=function(){var e={};return function(a,t,i){return 1==arguments.length?e[a]?e[a].expires<(new Date).getTime()?!1:e[a].data:!1:(i=i||600,void(e[a]={data:t,expires:(new Date).getTime()+1e3*i}))}}(),SABAI.flash=function(a,t){if("undefined"!=typeof a&&null!==a)if("string"==typeof a)e.growl(a,{type:t,delay:"danger"===t?0:5e3,z_index:999999});else for(var i=0;i<a.length;i++)SABAI.flash(a[i].msg,a[i].level)},SABAI.load=function(a,t,i){var n=e(a);return n.load(t,{__ajax:a},function(e,a,t){SABAI.init(n),i&&i.call(n,e,a,t)}),n},SABAI.replace=function(a,t,i,n){var o;return e.get(t,{__ajax:a},function(t,s,r){n?o=e(a).html(t):(e(a).replaceWith(t),o=e(a)),SABAI.init(o),i&&i.call(null,o,t,s,r)}),o},SABAI.popover=function(a,t,i){if(a=a instanceof jQuery?a:e(a),i||!a.hasClass("sabai-popover-processed")){if(t=t||{},t.animation=!1,t.template='<div class="sabai-popover"><div class="sabai-arrow"></div><div class="sabai-popover-inner"><div class="sabai-close"><i class="fa fa-times"></i></div><div class="sabai-popover-title"></div><div class="sabai-popover-content"></div></div></div>',t.url){var n=SABAI.cache(t.url);n?t.content=n:(t.content="&nbsp;",e.get(t.url,{__ajax:1},function(e){SABAI.cache(t.url,e),a.attr("data-content",e).data("bs.sabaipopover").tip().find(".sabai-popover-content").html(e),a.sabaipopover("show")}))}a.sabaipopover(t).sabaipopover("show").addClass("sabai-popover-processed").data("bs.sabaipopover").tip().css(t.width?{width:t.width}:{}).find(".sabai-close").on("click",function(){a.data("bs.sabaipopover").hide()}),SABAI.popoverInit||(e("body").on("click",function(a){e(".sabai-popover-processed").each(function(){e(this).is(a.target)||0!==e(this).has(a.target).length||0!==e(".sabai-popover").has(a.target).length||e(this).sabaipopover("hide")})}),SABAI.popoverInit=!0)}},SABAI.modal=function(){var a,t=function(){var a=e('<div class="sabai" id="sabai-modal" style="display:none;"><div class="sabai-modal-container"><div class="sabai-modal-title"><span></span><span class="sabai-close"><i class="fa fa-times"></i></span></div><div class="sabai-modal-content"></div><div class="sabai-modal-footer"></div></div></div>').prependTo("body").find(".sabai-close").mousedown(function(){e("#sabai-modal").fadeOut("fast",function(){e(this).remove()})}).end();return e(document).keyup(function(a){27==a.keyCode&&e("#sabai-modal").find(".sabai-close").mousedown()}),a},i=function(e,a){var t,i,n=document.documentElement.clientWidth<=768?.95:.8;(null===a||a>document.documentElement.clientWidth*n)&&(a=document.documentElement.clientWidth*n),e.find(".sabai-modal-container").css({width:a+"px",left:SABAI.isRTL?"auto":document.documentElement.clientWidth/2-a/2,right:SABAI.isRTL?document.documentElement.clientWidth/2-a/2:"auto",top:.07*document.documentElement.clientHeight}),i=e.find(".sabai-form-buttons").length?e.find(".sabai-form-buttons").outerHeight()+10:20,e.find(".sabai-modal-footer").css("height",i+"px"),t=.8*document.documentElement.clientHeight-e.find(".sabai-modal-title").outerHeight()-i,e.find(".sabai-modal-content").css("max-height",t+"px"),e.get(0).scrollHeight>document.documentElement.clientHeight&&e.find(".sabai-modal-content").css("height",t+"px")};return function(n,o,s,r){return a=r?r:e("body").has("#sabai-modal").length?e("#sabai-modal"):t(),(o||n)&&(o&&a.find(".sabai-modal-title > span:first").text(o),n&&a.find(".sabai-modal-content").html(n),a.show()),"undefined"!=typeof s&&(0===s&&(s=a.find(".sabai-modal-container").width()),i(a,s)),a}}(),SABAI.ajaxLoader=function(a,t,i){var n=e(a);if(i){var o=e(i);if(!o.length)return;if(t)o.next(".sabai-ajax-loader").remove();else{var s=e('<div class="sabai-ajax-loader"></div>').css("top",parseInt(o.position().top,10)+parseInt(o.css("margin-top"),10)+"px").width(o.outerWidth()).height(o.outerHeight());o.after(s)}n.length&&n.blur().prop("disabled",!t).css("pointer-events",t?"auto":"none")}else{if(!n.length)return;n.blur().prop("disabled",!t).css("pointer-events",t?"auto":"none").toggleClass("sabai-ajax-loading",!t)}},SABAI.ajax=function(a){var t,i,n=e.extend({trigger:null,async:!0,type:"get",url:"",data:"",processData:!0,target:"",container:null,modalWidth:null,cache:!1,cacheLifetime:600,onSendData:null,onSuccess:null,onError:null,onErrorFlash:!0,onContent:null,onSuccessFlash:!1,effect:null,scroll:!1,replace:!1,highlight:!1,callback:!1,loadingImage:!0,position:!1,toggle:!1,pushState:!1,state:{}},a),o="",s=function(a,t){try{var i=JSON.parse(a.replace(/<!--[\s\S]*?-->/g,""));if(n.onSuccess&&!n.onSuccess(i,t,n.trigger))return void(n.onSuccessFlash&&i.messages&&SABAI.flash(i.messages,"success"));if(i.url)return"#sabai-modal"===n.container&&e("#sabai-modal").hide(),void(window.location=i.url);n.onSuccessFlash&&i.messages&&SABAI.flash(i.messages,"success")}catch(o){SABAI.console.log("Failed parsing response:<p>"+a.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</p><p>"+o.toString()+"</p>")}},r=function(a,t){if("#sabai-modal"===n.container){if(n.trigger){var i=n.trigger.attr("data-modal-title");("undefined"==typeof i||i===!1)&&(i=n.trigger.attr("title")||n.trigger.attr("data-original-title")||""),SABAI.modal(a,i,n.modalWidth,t)}else SABAI.modal(a,"",n.modalWidth,t);n.onContent||(n.onContent=function(e,a,t){a.focusFirstInput()}),n.onContent(a,t,n.trigger)}else{if(n.trigger&&n.trigger.hasClass("sabai-toggle")&&e(SABAI).trigger("toggle.sabai",{trigger:n.trigger,target:t}),n.replace)n.scroll&&o&&SABAI.scrollTo(o),t=t.hide().after(a).remove().next(),n.onContent&&n.onContent(a,t,n.trigger);else{switch(n.callback||"sabai-content"==t.attr("id")||"sabai-inline-content"==t.attr("id")||t.addClass("sabai-ajax"),n.effect){case"slide":t.hide().html(a).slideDown("fast",function(){n.onContent&&n.onContent(a,t,n.trigger)});break;default:t.html(a).show(),n.onContent&&n.onContent(a,t,n.trigger)}n.scroll&&o&&SABAI.scrollTo(o)}if(n.highlight&&t.effect("highlight",{},1500),n.trigger&&n.trigger.hasClass("sabai-toggle")){var s=t.is(":visible");n.trigger.removeAttr("onclick").removeClass("sabai-click").toggleClass("sabai-active",s);var r=n.trigger.data("toggle-cookie");r&&e.cookie(r,s?1:0,{path:SABAI.path,domain:SABAI.domain}),e(SABAI).trigger("toggled.sabai",{trigger:n.trigger,target:t})}}if(n.pushState&&window.history&&window.history.pushState){var l=SABAI.parseUrl(n.url);l.pathname!==location.pathname&&(l.pathname=location.pathname),n.state.data=n.data,n.state.url=n.url,n.state.container=n.container,n.state.target=n.target,window.history.pushState(n.state,null,l.toString())}SABAI.init(t),e(SABAI).trigger("loaded.sabai",{target:t,selector:o})},l=function(e,a){try{var t=JSON.parse(e.replace(/<!--[\s\S]*?-->/g,""));if(n.onError){if(!n.onError(t,a,n.trigger))return void(n.onErrorFlash&&t.messages&&SABAI.flash(t.messages,"danger"))}else if(t.url)return void(window.location=t.url);n.onErrorFlash&&t.messages&&(n.trigger?(SABAI.popover(n.trigger,{content:t.messages[0],html:!0,container:n.trigger.closest(".sabai"),title:n.trigger.attr("data-sabaipopover-title")||""}),n.trigger.attr("onclick","return false;")):SABAI.flash(t.messages,"danger"))}catch(i){SABAI.console.log("Failed parsing response:<p>"+e.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</p><p>"+i.toString()+"</p>")}};if(n.trigger){if(n.trigger.hasClass("sabai-disabled"))return;n.trigger.data("cookie-name")&&n.trigger.data("cookie-value")&&e.cookie(n.trigger.data("cookie-name"),n.trigger.data("cookie-value"),{path:SABAI.path,domain:SABAI.domain}),n.url||(n.url=n.trigger.data("sabai-remote-url")),n.trigger.hasClass("sabai-dropdown-link")&&(n.trigger=n.trigger.closest(".sabai-btn-group").find(".sabai-dropdown-toggle"))}if(n.url){if(n.container)if(o=n.container,"#sabai-modal"===n.container)t=SABAI.modal();else if(n.target?(t=e(n.container).find(n.target),o=n.container+" "+n.target):t=e(n.container),!t.length)return void SABAI.console.log(o);if(n.cache&&"get"===n.type){var c=SABAI.cache(n.container+n.url);if(c)return void r(c,t)}n.onSendData&&("object"!=typeof n.data&&(n.data={}),n.onSendData(n.data,n.trigger)),"object"==typeof n.data?(n.data.hasOwnProperty("__ajax")||(n.data.__ajax=o||1),n.data=e.param(n.data)):"string"==typeof n.data&&""!==n.data?n.data+="&__ajax="+(o?encodeURIComponent(o):1):n.data="__ajax="+(o?encodeURIComponent(o):1),e.ajax({global:!0,async:n.async,type:n.type,dataType:"html",url:n.url,data:n.data,processData:n.processData,cache:!1,beforeSend:function(e){n.loadingImage&&(t&&"sabai-content"!==t.attr("id")&&t.is(":visible")?(i="sabai-modal"===t.attr("id")?t.find(".sabai-modal-content"):t,SABAI.ajaxLoader(n.trigger,!1,i)):SABAI.ajaxLoader(n.trigger))},complete:function(e,a){switch(a){case"success":278==e.status||e.getResponseHeader("content-type").indexOf("json")>-1?s(e.responseText,t):(r(e.responseText,t),"get"==n.type&&n.cache&&SABAI.cache(n.container+n.url,e.responseText,n.cacheLifetime));break;case"error":l(e.responseText,t)}n.loadingImage&&SABAI.ajaxLoader(n.trigger,!0,i)}})}},SABAI.scrollTo=function(a,t,i){a=a instanceof jQuery?a:e(a),t="undefined"!=typeof t&&null!==t?t:1e3,i="undefined"!=typeof i&&null!==i?i:0,e.sabaiScrollTo(a,t,{offset:{top:i}})},SABAI.states=function(a,t,i){var n,o,s,r,l={},c={enabled:"disabled",optional:"required",visible:"invisible",unchecked:"checked",expanded:"collapsed",unload_options:"load_options",show_options:"hide_options"},d=function(a,t,i,n){var o=e(a,n);o.length&&o.each(function(){var n,o,s,r,c;for(n in i)if(s=i[n],o=e(this).closest(s.container||"form").find(n),o.length){switch(r=[],s.type){case"checked":case"unchecked":case"selected":case"unselected":r.push("change","cloneremoved.sabai");break;case"filled":case"empty":r.push("keyup","cloneremoved.sabai");break;case"request":case"requested":r.push("requested.sabai");break;case"values":default:r.push("keyup","change","cloneremoved.sabai")}l[n]={};for(var d=0;d<r.length;d++)c={selector:a,action:t},c.conditions=i,c.container=s.container||"form",o.bind(r[d],c,function(a,t){f(e(this),a.data.selector,a.data.action,a.data.conditions,a.data.container,a.type,t),a.stopPropagation()}),l[n][r[d]]=!0}else SABAI.console.log("Invalid or non existent dependee selector: "+n)})},f=function(e,a,t,i,n,o,s){var r,l,d,f=!0,p=e.closest(n);for(r in i){if(l=p.find(r),!l.length){f=!1;break}if(d=i[r],!u(l,d.type||"value",d.value)){f=!1;break}}t in c&&(t=c[t],f=!f),g(p.find(a),t,f,e,o,s,a)},u=function(a,t,i){switch(t){case"value":case"values":"object"!=typeof i&&(i=[i]);var n=[];a.length>1?a.each(function(){"checkbox"===this.type||"radio"===this.type?this.checked&&n.push(this.value):n.push(e(this).val())}):n.push(a.val());var o=i.length,s=n.length;e:for(var r=0;o>r;r++){for(var l=0;s>l;l++)if("object"!=typeof i[r]){if(i[r]==n[l]){if("value"===t)return!0;continue e}}else if(p(i[r][0],n[l],i[r][1])){if("value"===t)return!0;continue e}if("values"===t)return!1}return"values"===t?!0:!1;case"checked":case"unchecked":var c=!1;return a.each(function(){return e(this).prop("checked")===Boolean(i)?(c=!0,!1):void 0}),"checked"===t?c:!c;case"empty":case"filled":case"selected":var c=!1;return a.each(function(){return""===e.trim(a.val())===Boolean(i)?(c=!0,!1):void 0}),"empty"===t?c:!c;case"collapsed":case"expanded":var c=!1;return a.each(function(){return(a.hasClass("sabai-form-collapsible")&&a.hasClass("sabai-form-collapsed"))===Boolean(i)?(c=!0,!1):void 0}),"collapsed"===t?c:!c;case"request":return a.data("request-url")&&a.data("request-result")===i;case"requested":if(a.data("request-url")){var c=a.data("request-result");return("success"===c||"error"===c)===Boolean(i)}return!1;default:return alert("Invalid condition type: "+t),!1}},p=function(e,a,t){switch(t){case"==":return e==a;case"!=":return e!=a;case"<":return a>e;case">":return e>a}},g=function(a,t,n,o,s,r,c){switch(t){case"disabled":a.find(":input").prop("disabled",n);break;case"required":a.toggleClass("sabai-form-field-required",n);break;case"invisible":a.toggleClass("sabai-form-states-invisible",n),n?(a.hide(),r||a.prev(".sabai-form-field").parent().find(".sabai-form-field:visible:last").addClass("sabai-form-field-no-margin")):a.is(":hidden")&&(r?a.show():a.css("opacity",0).slideDown("fast").animate({opacity:1},{queue:!1,duration:"slow"}).prev(".sabai-form-field").removeClass("sabai-form-field-no-margin"));break;case"checked":a.find(":checkbox").prop("checked",n).change();break;case"load_options":if("change"!==s)return;var d=a.find("select");d.find('option[value!=""]').remove();var f=l[c+" select"]&&l[c+" select"].change;if(n){var u=d.data("load-url"),p=u+o.val(),g=SABAI.cache(p),h=function(t){if(SABAI.cache(p,t),"undefined"!=typeof t&&0===t.length)return a.hide(),d.data("default-value","").val(""),void(f&&d.trigger("change",[r]));if(e.each(t,function(a,t){d.append(e("<option></option>").text(t[1]).val(t[0]))}),!i){var n=d.data("default-value");"undefined"!=typeof n&&(d.val(n),f&&d.trigger("change",[r]))}if(!a.hasClass("sabai-form-states-invisible")&&a.is(":hidden")&&d.find('option[value!=""]').length){a.removeClass("sabai-hidden").addClass("sabai-was-hidden");var o=a.find(".sabai-form-field-prefix").length?"inline-block":"block";r?a.css("display",o):a.hide().css("display",o).fadeIn("fast")}};g!==!1?h(g):(o.addClass("sabai-ajax-loading"),e.getJSON(u,{value:o.val()},h).always(function(){o.removeClass("sabai-ajax-loading")}))}else!a.is(":hidden")&&a.hasClass("sabai-was-hidden")&&(a.hide(),d.data("default-value","").val(""),f&&d.trigger("change",[r]));break;case"request_url":n?SABAI.ajax({target:a,url:a.data("request-url"),onSuccess:function(e,t,i){a.data("request-result","success").trigger("requested.sabai")},onError:function(e,t,i){a.data("request-result","error").trigger("requested.sabai")},onContent:function(e,t,i){a.data("request-result","error").trigger("requested.sabai")}}):a.data("request-result","");break;case"collapsed":if(!a.hasClass("sabai-form-collapsible"))return;(n&&!a.hasClass("sabai-form-collapsed")||!n&&a.hasClass("sabai-form-collapsed"))&&a.find("a.sabai-form-collapsible:first").click();break;case"hide_options":if(!n||!o.prop("checked"))return;a.find("input").each(function(){var a=e(this),t=a.data("values"),i=a.closest(".sabai-form-field");i[t&&-1!==e.inArray(o.val(),t)?"slideDown":"hide"]()});break;default:alert("Invalid action: "+t)}};for(n in a){o=a[n];for(action in o)d(n,action,o[action].conditions,t)}for(s in l)for(r in l[s])e(s,t).trigger(r,[!0])},SABAI.cloneField=function(a,t,i,n,o){var s=e(a),r=s.find("> .sabai-form-field:not(.sabai-form-field-add)"),l=n||r.length;if(!(i&&l>=i)){var c=r.first(),d=c.clone().attr("id","sabai-"+SABAI.guid()).find(":input").each(function(){var a=jQuery(this);a.attr("name")&&(field_name=o.data("field-form-wrap")?o.data("field-form-wrap")+"["+t+"]":t,a.attr("name",a.attr("name").replace(field_name+"[0]",field_name+"["+l+"]"))),a.attr("id")&&a.attr("id",a.attr("id")+"-"+l),a.removeData("default-value").removeAttr("data-default-value"),e.fn.uniform&&a.parent().is(".selector")&&a.prev("span").remove().end().unwrap().uniform().parent(".selector").show()}).end().clearInput().removeClass("sabai-form-field-error").find("span.sabai-form-field-error").remove().end().find(".sabai-was-hidden").hide().end().hide().insertAfter(r.last());d.append('<a class="sabai-btn sabai-btn-danger sabai-btn-xs sabai-form-field-remove" href="#"><i class="fa fa-times" title="Remove this field"></i></a>').slideDown("fast").focusFirstInput().find("a.sabai-form-field-remove").click(function(a){e(this).closest(".sabai-form-field").fadeTo("fast",0,function(){e(this).slideUp("fast",function(){e(this).remove();var a=s.find("> .sabai-form-field:not(.sabai-form-field-add)");i&&a.length<i&&o.show(),a.find(":input").trigger("cloneremoved.sabai")})}),a.preventDefault()}).parent().css("position","relative"),e(SABAI).trigger("clonefield.sabai",{container:a,field:c,clone:d,index:l}),i&&o&&l+1>=i&&o.hide()}},SABAI.addOption=function(a,t,i,n,o){var s=e(a),r=e(i).closest(".sabai-form-field-option"),l=s.find("> .sabai-form-field-option"),c=n?t+"[default][]":t+"[default]",d=r.find("input[name='"+c+"']").val(),f=r.clone().find(":text").each(function(){var e=jQuery(this);e.attr("name")&&e.attr("name",e.attr("name").replace(t+"[options]["+d+"]",t+"[options]["+l.length+"]"))}).end().clearInput().find("input[name='"+c+"']").val(l.length).end().hide().insertAfter(r);return o&&o.call(null,f),f.slideDown("fast").focusFirstInput(),!1},SABAI.removeOption=function(a,t,i){var n=e(a).find("> .sabai-form-field-option:not(.sabai-form-field-option-disabled)");return 1===n.length?void n.clearInput():confirm(i)?void e(t).closest(".sabai-form-field-option").slideUp("fast",function(){e(this).remove()}):!1},SABAI.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=16*Math.random()|0,t="x"==e?a:3&a|8;return t.toString(16)})},window.history&&window.history.pushState){var a=!1,t=window.location.href.replace(/%2F/g,"/");e(window).on("popstate",function(i){if(a||(a=!0,location.href.replace(/%2F/g,"/")!=t)){var n=i.originalEvent.state;n?(n.data.__ajax=n.target?n.container+" "+n.target:n.container,SABAI.ajax(n),e(SABAI).trigger("sabaipopstate.sabai",n)):window.location.href=window.location.href}})}SABAI.parseUrl=function(a){var t=a?e("<a/>").prop("href",a)[0]:window.location;if(t.query={},t.search&&"string"==typeof t.search){var i=t.search.substr(1).replace(/\+/g,"%20").split("&");e.each(i,function(e,a){var i=a.split("=");try{i[1]=decodeURIComponent(i[1])}catch(n){}t.query[i[0]]=i[1]})}return t},SABAI.getScript=function(a,t,i){return t=e.extend(t||{},{dataType:"script",cache:!0,url:a}),jQuery.ajax(t,i)},e.fn.sabai=function(){SABAI.init(this)},e.fn.focusTextRange=function(e,a){if(this.is('input[type="text"]')||this.is("textarea")){var t=this.get(0);if(t.setSelectionRange)t.focus(),t.setSelectionRange(e,a);else if(t.createTextRange){var i=t.createTextRange();i.collapse(!0),i.moveEnd("character",a),i.moveStart("character",e),i.select()}}return this},e.fn.focusFirstInput=function(){var e=this.find('input[type="text"],input[type="password"],textarea').not(".sabai-focus-off").filter(":visible:first");if(!e.length)return this;var a=e.val().length;return e.focusTextRange(a,a),this},e.fn.clearInput=function(){return this.each(function(){var a=e(this),t=a.get(0).tagName.toLowerCase();if("undefined"!=typeof a.data("default-value"))return void a.val(a.data("default-value"));if("input"===t){var i=a.attr("type");"checkbox"===i||"radio"===i?a.prop("checked",!1):a.val("")}else if("textarea"===t)a.val("");else{if("select"!==t)return a.find(":input").clearInput();a.prop("selectedIndex",0)}})}}(jQuery);