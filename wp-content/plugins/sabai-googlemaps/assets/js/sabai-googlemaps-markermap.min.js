(function(a){SABAI.GoogleMaps=SABAI.GoogleMaps||{};SABAI.GoogleMaps.markerMap=SABAI.GoogleMaps.markerMap||function(c,t,s){var n=a(c),o=n.find(".sabai-googlemaps-address"),i=n.find(".sabai-googlemaps-map"),r,p,k,f=function(){return SABAI.GoogleMaps.markerMapAddress},j=function(){if(!k){k=new google.maps.Geocoder()}return k},l=function(u){i.find(".sabai-googlemaps-map-zoom").val(r.getZoom());i.find(".sabai-googlemaps-map-lat").val(u.lat());i.find(".sabai-googlemaps-map-lng").val(u.lng());h()},d=function(u){p.setPosition(u);p.setAnimation(google.maps.Animation.BOUNCE);window.setTimeout(function(){p.setAnimation(null);r.panTo(u);l(u)},1000)},h=function(u){var v;v=p.getPosition();if(!v){return}j().geocode({latLng:v},function(A,y){if(y==google.maps.GeocoderStatus.OK){if(A[0]){if(A[0].address_components){var w={};for(var z in A[0].address_components){if(typeof(A[0].address_components[z])!=="object"||!A[0].address_components[z].types[0]||!A[0].address_components[z].long_name){continue}w[A[0].address_components[z].types[0]]={value:A[0].address_components[z].long_name,short_value:A[0].address_components[z].short_name}}}var x=n.find(".sabai-googlemaps-formatted-address");if(x.length&&(u||!x.val())){x.val(A[0].formatted_address||"")}o.find('[class^="sabai-googlemaps-address-"]').filter(":input:visible").val("");f().setAddress(o,w,t)}else{alert("Geocoder returned no address components")}}else{alert("Geocoder failed due to: "+y)}})},q,g=[];for(q in google.maps.MapTypeId){g.push(google.maps.MapTypeId[q])}g.push("osm");r=new google.maps.Map(i.find(".sabai-googlemaps-map-map").get(0),{mapTypeControl:true,mapTypeId:a.inArray(i.data("map-type"),g)!==-1?i.data("map-type"):google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:g},zoom:i.data("zoom"),center:new google.maps.LatLng(i.data("center-lat"),i.data("center-lng")),scrollwheel:false,styles:null});r.mapTypes.set("osm",new google.maps.ImageMapType({getTileUrl:function(v,u){return"//tile.openstreetmap.org/"+u+"/"+v.x+"/"+v.y+".png"},tileSize:new google.maps.Size(256,256),isPng:true,maxZoom:19,minZoom:0,name:"OSM"}));p=new google.maps.Marker({map:r,draggable:true,animation:google.maps.Animation.DROP});if(i.data("lat")&&i.data("lng")){p.setPosition(new google.maps.LatLng(i.data("lat"),i.data("lng")))}google.maps.event.addListener(r,"click",function(u){d(u.latLng)});google.maps.event.addListener(r,"zoom_changed",function(u){i.find(".sabai-googlemaps-map-zoom").val(r.getZoom())});google.maps.event.addListener(p,"dragend",function(u){window.setTimeout(function(){r.panTo(u.latLng);l(u.latLng)},1000)});i.find(".sabai-googlemaps-map-lat, .sabai-googlemaps-map-lng").change(function(){var v=i.find(".sabai-googlemaps-map-lat").val(),u=i.find(".sabai-googlemaps-map-lng").val();if(v&&u){google.maps.event.trigger(r,"click",{latLng:new google.maps.LatLng(v,u)})}});i.find(".sabai-googlemaps-map-map").fitMaps();n.find(".sabai-googlemaps-find-on-map").click(function(){var u=n.find(".sabai-googlemaps-formatted-address");if(!u.length){return false}j().geocode({address:a.trim(u.val())},function(w,v){if(v==google.maps.GeocoderStatus.OK){d(w[0].geometry.location)}else{alert("Geocoder failed due to: "+v)}});return false});n.find(".sabai-googlemaps-get-from-map").click(function(){h(true);return false});if(navigator.geolocation){var e=n.find(".sabai-googlemaps-formatted-address");if(e.length){var b=a('<span style="position:absolute; right:0; cursor:pointer; width:24px; height:24px; padding:4px; margin-right:1px;"><img style="vertical-align:baseline !important;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAA/AAAAPwFHl4ngAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAADBQTFRF////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL92gewAAAA90Uk5TAAYTOklcfYiNkZ+oueHn8F/YJAAAAE9JREFUCFtjYGBgYC9ggAAYg7n3hgGIZpyX4vZSAMjgPBS1VGcCkGGn/f//psdARlv8//9fMxgYyq+s////l285ggGXQiiGa4cbCLcC3XYA7R8qgYIYH20AAAAASUVORK5CYII6c7cb9f3bd9ed4aaf8b60b0d7d242d61="/></span>');b.insertAfter(e);var m=(e.outerHeight()-b.outerHeight())/2+parseInt(e.css("margin-top"));b.css("top",m+"px").click(function(v){var u=a(this);SABAI.ajaxLoader(e);k=new google.maps.Geocoder();navigator.geolocation.getCurrentPosition(function(w){k.geocode({latLng:new google.maps.LatLng(w.coords.latitude,w.coords.longitude)},function(y,x){SABAI.ajaxLoader(u,true);if(x==google.maps.GeocoderStatus.OK){e.val(y[0].formatted_address).effect("highlight",{},2000);d(new google.maps.LatLng(w.coords.latitude,w.coords.longitude))}});SABAI.ajaxLoader(e,true)},function(w){SABAI.ajaxLoader(e,true);SABAI.console.log(w.message+" ("+w.code+")")},{enableHighAccuracy:true,timeout:5000});return false})}}if(s){a(SABAI).bind("clonefield.sabai",function(v,u){if(u.clone.hasClass("sabai-form-type-googlemaps-marker")||u.clone.hasClass("sabai-googlemaps-form-container")){u.clone.find(".sabai-googlemaps-map").data("lat",null).data("lng",null);SABAI.GoogleMaps.markerMap(u.clone,t,false)}})}};SABAI.GoogleMaps.markerMapAddress={_loadVal:function(c,e,b){var d=c.find(b);if(d.get(0).tagName.toLowerCase()==="select"){d.val(e.short_value)}else{d.val(e.value)}},_setAddress:function(c,b,e){var d;if(b.street_address){d=b.street_address.val()}else{if(b.route){if(b.street_number){d=b.street_number.value+" "+b.route.value}else{d=b.route.value}}}c.find(".sabai-googlemaps-address-street").val(d)},setAddress:function(c,b,f){var e;for(var d in b){switch(d){case"sublocality":case"locality":SABAI.GoogleMaps.markerMapAddress._loadVal(c,b[d],".sabai-googlemaps-address-city");break;case"administrative_area_level_1":SABAI.GoogleMaps.markerMapAddress._loadVal(c,b[d],".sabai-googlemaps-address-province");break;case"postal_code":SABAI.GoogleMaps.markerMapAddress._loadVal(c,b[d],".sabai-googlemaps-address-zip");break;case"country":e=b[d].short_value;SABAI.GoogleMaps.markerMapAddress._loadVal(c,b[d],".sabai-googlemaps-address-country");break}}if(e&&SABAI.GoogleMaps.markerMapAddress[e]&&SABAI.GoogleMaps.markerMapAddress[e].setAddress){SABAI.GoogleMaps.markerMapAddress[e].setAddress(c,b,f)}else{SABAI.GoogleMaps.markerMapAddress._setAddress(c,b,f)}},JP:{setAddress:function(j,l,c){var f,b="",i="",h="",g="",e="",d="";for(var k in l){switch(k){case"ward":b=l[k].value;break;case"sublocality_level_1":i=l[k].value;break;case"sublocality_level_2":h=l[k].value;break;case"sublocality_level_3":g=l[k].value;break;case"sublocality_level_4":e=l[k].value;break;case"sublocality_level_5":d=l[k].value;break}}if(c==="ja"){f=b+i+h+[g,e,d].filter(Boolean).join("ãƒ¼")}else{f=[b,i,h,[g,e,d].filter(Boolean).join("-")].filter(Boolean).join(" ")}j.find(".sabai-googlemaps-address-street").val(f)}}}})(jQuery);